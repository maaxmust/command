const express = require('express');
const axios = require('axios');
const cors = require('cors');

const app = express();
const port = process.env.PORT || 3000;

// Dein Wetter-API-Key (direkt im Code)
const apiKey = '9f2a7dab0d2248f89aa23315252802';

app.use(cors());

/* ---------------- NUTZLOS-COMMAND ---------------- */

function generateDailyValue(username) {
    const today = new Date().toISOString().split('T')[0];
    const normalizedUsername = username.toLowerCase();
    const seed = `${normalizedUsername}-${today}`;

    let hash = 0;
    for (let i = 0; i < seed.length; i++) {
        hash = (hash << 5) - hash + seed.charCodeAt(i);
    }

    return Math.abs(hash % 100) + 1;
}

app.get('/nutzlos/:username', (req, res) => {
    const username = req.params.username;
    const value = generateDailyValue(username);
    res.send(`${username}, du bist heute zu ${value}% nutzlos ğŸ˜œ`);
});

/* ---------------- WETTER-COMMAND ---------------- */

// Stadtname mit groÃŸem Anfangsbuchstaben
function capitalizeCityName(city) {
    if (!city || typeof city !== 'string') return city;
    return city.charAt(0).toUpperCase() + city.slice(1);
}

// Wetterbeschreibung + Emojis (Deutsch + Englisch)
function getWeatherEmoji(description) {
    const text = description.toLowerCase();

    // â˜€ï¸ Sonnig / klar
    if (text.includes('klar') || text.includes('sonnig') || text.includes('clear')) return 'â˜€ï¸ Klarer Himmel';

    // ğŸŒ¤ï¸ Leicht bewÃ¶lkt
    if (text.includes('leicht bewÃ¶lkt') || text.includes('partly cloudy')) return 'ğŸŒ¤ï¸ Leicht bewÃ¶lkt';

    // ğŸŒ¥ï¸ BewÃ¶lkt
    if (text.includes('bewÃ¶lkt') || text.includes('cloudy')) return 'ğŸŒ¥ï¸ BewÃ¶lkt';

    // â˜ï¸ Stark bewÃ¶lkt / Overcast
    if (text.includes('stark bewÃ¶lkt') || text.includes('overcast')) return 'â˜ï¸ Stark bewÃ¶lkt';

    // ğŸŒ§ï¸ Regen
    if (text.includes('regen') || text.includes('rain')) return 'ğŸŒ§ï¸ Regen';

    // ğŸŒ¦ï¸ Nieselregen
    if (text.includes('nieselregen') || text.includes('drizzle')) return 'ğŸŒ¦ï¸ Nieselregen';

    // â„ï¸ Schnee
    if (text.includes('schnee') || text.includes('snow')) return 'â„ï¸ Schnee';

    // ğŸŒ¨ï¸ Schneeregen / Hagel / Graupel
    if (text.includes('schneeregen') || text.includes('hail') || text.includes('graupel')) return 'ğŸŒ¨ï¸ Schneeregen';

    // ğŸŒ«ï¸ Nebel / Dunst / Mist / Fog
    if (text.includes('nebel') || text.includes('dunst') || text.includes('
